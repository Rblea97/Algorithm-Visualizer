name: Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        
    - name: Build Windows executable
      run: |
        python -m PyInstaller --onefile --windowed --name "Algorithm-Visualizer" main.py
        
    - name: Generate checksum
      run: |
        certutil -hashfile "dist/Algorithm-Visualizer.exe" SHA256 > "dist/Algorithm-Visualizer.exe.sha256"
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/Algorithm-Visualizer.exe
          dist/Algorithm-Visualizer.exe.sha256
        body: |
          ## Algorithm Visualizer ${{ github.ref_name }}
          
          ### Downloads
          - **Windows**: Algorithm-Visualizer.exe (no Python installation required)
          - **Source**: Use the source code archive below
          
          ### Installation
          **Windows**: Download and run the .exe file
          **Source**: Requires Python 3.8+ - run `python main.py`
          
          Includes SHA256 checksum for verification.

  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"
    
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-tk
        python -m pip install --upgrade pip
        pip install pyinstaller
        
    - name: Build Linux executable
      run: |
        python -m PyInstaller --onefile --name "algorithm-visualizer" main.py
        
    - name: Generate checksum
      run: |
        sha256sum "dist/algorithm-visualizer" > "dist/algorithm-visualizer.sha256"
        
    - name: Upload to Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/algorithm-visualizer
          dist/algorithm-visualizer.sha256